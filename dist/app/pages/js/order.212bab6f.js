var order={init:function(){this.initData(),this.initEvent()},initData:function(){function t(t){for(var a,s,e,n,r,o="",d=0,i=t.length;d<i;d++){for(o+='<li><div class="order-text clearfix"><span class="fl">下单时间：'+(a=t[d]).date+'</span><span class="fr">订单号：'+a.orderNo+"</span></div>",s=0,e=a.goods.length;s<e;s++)o+='<div class="order-product clearfix"><div class="img fl"><img src="'+(n=a.goods[s]).goodsThums+'"></div><div class="desc fl">'+n.goodsName+"</div>",o+='<div class="price fl"><div>￥'+n.goodsPrice+'</div><div class="quantity"><span class="small">X</span><span>'+n.goodsNums+"</span></div></div></div>";o+='<div class="total-price"><span class="deliver-fee">'+(0==a.shippingFee?"包邮":"邮费："+a.shippingFee)+"</span><span>总价：￥"+a.totalMoney+"</span></div>",-2==a.orderStatus?(r=0==a.isPay&&3==a.payFrom?"offline":"online",o+='<div class="order-status clearfix" data-id="'+a.orderId+'"><span class="fl status">'+("offline"==r?"等待汇款":"等待支付")+"</span>",o+='<span class="fr btns-wrapper"><button class="btn btn-sm order-cancel" data-id="'+a.orderId+'">取消订单</button>',"offline"==r&&(o+='<button class="btn btn-sm order-pay" data-id="'+a.orderId+'">汇款信息</button>'),o+='<button class="btn btn-sm order-detail" data-id="'+a.orderId+'">订单详情</button><a class="btn btn-sm pay" href="pay.html?orderId='+a.orderId+'">支付</a></span></div>'):-11==a.orderStatus?o+='<div class="order-status clearfix" data-id="'+a.orderId+'"><span class="fl status done">已取消</span><span class="fr btns-wrapper"><button class="btn btn-sm order-detail" data-id="'+a.orderId+'">订单详情</button></span></div>':3==a.orderStatus?(o+='<div class="order-status clearfix" data-id="'+a.orderId+'"><span class="fl status done">已发货</span><span class="fr btns-wrapper">',o+='<button class="btn btn-sm order-detail" data-id="'+a.orderId+'">订单详情</button><a class="btn btn-sm complaint" href="https://kefu.easemob.com/webim/im.html?tenantId=2782&emgroup=OKAY%E5%95%86%E5%9F%8E">申请售后</a></span></div>'):1!=a.isPay&&2!=a.orderStatus||(o+='<div class="order-status clearfix" data-id="'+a.orderId+'"><span class="fl status done">已支付</span><span class="fr btns-wrapper">',o+='<button class="btn btn-sm order-detail" data-id="'+a.orderId+'">订单详情</button><a class="btn btn-sm complaint" href="https://kefu.easemob.com/webim/im.html?tenantId=2782&emgroup=OKAY%E5%95%86%E5%9F%8E">申请售后</a></span></div>'),o+="</li>"}return o}var a=this;a.token=Okay.util.getCookie("mall_token"),a.token?($("#menu").append(Okay.util.createMenuList()),Okay.Ajax("post","/index.php?m=OkayMall&c=mobileOrders&a=myOrders",{mall_token:a.token}).done(function(s){a.orderList=s.orderList,0==s.goodsSum?$(".num").hide().parent().show():$(".num").html(s.goodsSum>99?"99+":s.goodsSum).parent().show(),a.orderList.length?$(".order-list").html(t(a.orderList)):$("#page-list").hide().next().show()})):window.location.href="login.html"},initEvent:function(){var t=this,a=$(".order-list");$("#theme").on("tap",function(t){t.preventDefault(),$("#menu").show()}),$("#menu").on("tap","a",function(t){t.preventDefault(),$("#menu").hide(),window.location.href=$(this).data("href")}),$("#close").on("tap",function(t){t.preventDefault(),$("#menu").hide(),$("body").removeClass("with-menu")}),$("#user").on("tap",function(){window.location.href="user.html"}),a.on("tap",".order-cancel",function(a){a.preventDefault();var s=$(this),e=$(this).data("id");Okay.Dialog.confirm({content:"<p>您确定要取消订单吗?</p>",text:["不取消","取消订单"],onaccept:function(){Okay.Ajax("post","/index.php?m=OkayMall&c=mobileOrders&a=cancelOrder",{mall_token:t.token,orderId:e}).done(function(t){s.parents(".order-status").html('<span class="fl status done">已取消</span><span class="fr btns-wrapper"><button class="btn btn-sm order-detail" data-id="'+e+'">订单详情</button></span>')})}})}).on("tap",".order-detail",function(a){a.preventDefault();var s=$(this).data("id"),e=Okay.util.filter(t.orderList,{orderId:s});Okay.Dialog.alert({title:"订单详情",content:function(t){var a='<div class="text-left"><p class="em">'+t.userName+" "+t.userPhone+"</p>";return a+='<p class="area">'+t.city+"</p><p>"+t.street+"</p>",t.email&&(a+='<p class="mail">'+t.email+"</p>"),a+='<p class="deliver">送货上门</p>',t.remarks&&(a+='<p class="deliver">'+t.remarks+"</p></div>"),a}(e),text:"我知道了"})}).on("tap",".order-pay",function(t){t.preventDefault(),Okay.Dialog.alert({title:"汇款信息",content:'<div class="text-left"><p class="em group">开户银行：交通银行北京阜外支行</p><p class="em group">银行账号：1100 6023 9018 8000</p><p class="em group pl-5">23363</p><p class="em group">公司名称：北京点石经纬科技有限公司</p><p class="bank">请在汇款时写清您的订单号、手机号、姓名</p><div>',text:"我知道了"})})}};