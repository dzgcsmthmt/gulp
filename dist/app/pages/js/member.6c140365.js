var member={submitObj:{},showObj:{},schoolIds:[1,2,3],areaCache:{},timer:null,provinces:[["110000","北京市"],["500000","重庆市"],["310000","上海市"],["120000","天津市"],["340000","安徽省"],["350000","福建省"],["820332","广东省"],["450000","广西壮族自治区"],["520000","贵州省"],["620000","甘肃省"],["130000","河北省"],["410000","河南省"],["420000","湖北省"],["430000","湖南省"],["460000","海南省"],["230000","黑龙江省"],["320000","江苏省"],["360000","江西省"],["220000","吉林省"],["210000","辽宁省"],["150000","内蒙古自治区"],["640000","宁夏回族自治区"],["630000","青海省"],["370000","山东省"],["140000","山西省"],["510000","四川省"],["610000","陕西省"],["540000","西藏自治区"],["650000","新疆维吾尔自治区"],["530000","云南省"],["330000","浙江省"]],cities:[],counties:[],schools:{1:[{value:3,text:"一年级"},{value:4,text:"二年级"},{value:5,text:"三年级"},{value:6,text:"四年级"},{value:7,text:"五年级"},{value:8,text:"六年级"}],2:[{value:9,text:"七年级"},{value:10,text:"八年级"},{value:11,text:"九年级"}],3:[{value:12,text:"高一"},{value:13,text:"高二"},{value:14,text:"高三"}]},relation:[{value:1,text:"父母"},{value:2,text:"祖孙"},{value:3,text:"外祖"},{value:4,text:"其他"}],education:[{value:1,text:"博士"},{value:2,text:"硕士"},{value:3,text:"本科"},{value:4,text:"专科"},{value:5,text:"高中"},{value:6,text:"初中"},{value:7,text:"小学"}],career:[{value:1,text:"专业人士"},{value:2,text:"服务业人员"},{value:3,text:"自由职业者"},{value:4,text:"工人"},{value:5,text:"公司职员"},{value:6,text:"商人/雇主"},{value:7,text:"公务员"},{value:8,text:"学生"},{value:9,text:"家庭主妇"},{value:10,text:"其他"}],init:function(){this.initData(),this.bindEvent()},initData:function(){var e=this;e.token=Okay.util.getCookie("mall_token"),e.token||(window.location.href="login.html")},bindEvent:function(){function e(e,t,a){for(var n="",i=0,o=e.length;i<o;i++)n+="<option value="+e[i][0]+">"+e[i][1]+"</option>";$("#drum_"+t).remove(),$("#"+t).removeData().html(n).drum({onChange:function(e){var t=e.options[e.selectedIndex];a({text:t.text,value:t.value})}})}function t(e,t,a){for(var n="",i=0,o=e.length;i<o;i++)n+="<option value="+e[i].value+">"+e[i].text+"</option>";$("#drum_"+t).remove(),$("#"+t).removeData().html(n).drum({onChange:function(e){var t=e.options[e.selectedIndex];a({text:t.text,value:t.value})}})}var a=this,n=location.search;$(".back").on("tap",function(){window.history.back()}),$("#school").on("tap",function(){var e={level:{},grade:{}};e.level.value=a.submitObj.level||1,e.level.text=a.showObj.level||"小学",e.grade.value=a.submitObj.grade||3,e.grade.text=a.showObj.grade||"一年级",new Okay.Select({title:"年级",content:[{id:"school-select",select:[{value:1,text:"小学"},{value:2,text:"中学"},{value:3,text:"高中"}],onChange:function(n){var i=n.options[n.selectedIndex];e.level.value=i.value,e.level.text=i.text,e.grade.value=a.schools[i.value][0].value,e.grade.text=a.schools[i.value][0].text,t(a.schools[i.value],"grade-select",function(t){e.grade.value=t.value,e.grade.text=t.text},e.grade)},selectIndex:a.schoolIds.indexOf(+a.submitObj.level||1)},{id:"grade-select",select:a.schools[a.submitObj.level||1],onChange:function(t){var a=t.options[t.selectedIndex];e.grade.value=a.value,e.grade.text=a.text},selectIndex:Okay.util.findWhere(a.schools[a.submitObj.level||1],{value:a.submitObj.grade})}],onaccept:function(){a.submitObj.level=e.level.value,a.showObj.level=e.level.text,a.submitObj.grade=e.grade.value,a.showObj.grade=e.grade.text,$("#school").addClass("selected").find("span").html(e.level.text+" "+e.grade.text)}})}),$("#relation").on("tap",function(){var e={};e.value=a.submitObj.relation||a.relation[0].value,e.text=a.showObj.relation||a.relation[0].text,new Okay.Select({title:"与学生关系",content:[{id:"relation-select",select:a.relation,onChange:function(t){var a=t.options[t.selectedIndex];e.value=a.value,e.text=a.text},selectIndex:Okay.util.findWhere(a.relation,{value:a.submitObj.relation})}],onaccept:function(){a.submitObj.relation=e.value,a.showObj.relation=e.text,$("#relation").addClass("selected").find("span").html(e.text)}})}),$("#education").on("tap",function(){var e={};e.value=a.submitObj.education||a.education[0].value,e.text=a.showObj.education||a.education[0].text,new Okay.Select({title:"文化程度",content:[{id:"education-select",select:a.education,onChange:function(t){var a=t.options[t.selectedIndex];e.value=a.value,e.text=a.text},selectIndex:Okay.util.findWhere(a.education,{value:a.submitObj.education})}],onaccept:function(){a.submitObj.education=e.value,a.showObj.education=e.text,$("#education").addClass("selected").find("span").html(e.text)}})}),$("#career").on("tap",function(){var e={};e.value=a.submitObj.work||a.career[0].value,e.text=a.showObj.career||a.career[0].text,new Okay.Select({title:"职业",content:[{id:"career-select",select:a.career,onChange:function(t){var a=t.options[t.selectedIndex];e.value=a.value,e.text=a.text},selectIndex:Okay.util.findWhere(a.career,{value:a.submitObj.work})}],onaccept:function(){a.submitObj.work=e.value,a.showObj.career=e.text,$("#career").addClass("selected").find("span").html(e.text)}})}),$("#area").on("tap",function(){function t(){new Okay.Select({title:"区域",content:[{id:"provice-select",select:a.provinces,onChange:function(t){var u=t.options[t.selectedIndex];c.provice.id=u.value,c.provice.name=u.text,clearTimeout(a.timer),l?a.timer=setTimeout(function(){n(u.value,function(){e(c.cities,"city-select",function(t){c.city.id=t.value,c.city.name=t.text,i(t.value,function(t){e(c.counties,"county-select",function(e){o(e)})})}),i(c.cities[0][0],function(t){e(c.counties,"county-select",function(e){o(e)})})})},150):l=!0},selectIndex:Okay.util.findWhere(a.provinces,{0:c.provice.id})},{id:"city-select",select:c.cities,onChange:function(t){var a=t.options[t.selectedIndex];c.city.id=a.value,c.city.name=a.text,i(a.value,function(t){e(c.counties,"county-select",function(e){o(e)})})},selectIndex:Okay.util.findWhere(c.cities,{0:c.city.id})},{id:"county-select",select:c.counties,onChange:function(e){o(e)},selectIndex:Okay.util.findWhere(c.counties,{0:c.county.id})}],onaccept:function(){a.submitObj.proviceId=c.provice.id,a.showObj.proviceName=c.provice.name,a.submitObj.cityId=c.city.id,a.showObj.cityName=c.city.name,a.submitObj.countyId=c.county.id,a.showObj.countyName=c.county.name,a.cities=c.cities,a.counties=c.counties,$("#area").addClass("selected").find("span").html(c.provice.name+" "+c.city.name+" "+c.county.name)}})}function n(e,t){a.areaCache[e]?(c.cities=a.areaCache[e],c.city.id=c.cities[0][0],c.city.name=c.cities[0][1],t&&t()):Okay.Ajax("post","/index.php?m=OkayMall&c=mobileAreas&a=getAllAreas",{parentId:e}).done(function(n){c.cities=n.data.cities,a.areaCache[e]=n.data.cities,Okay.util.extendDefaults(a.areaCache,n.data.counties),c.city.id=c.cities[0][0],c.city.name=c.cities[0][1],t&&t()})}function i(e,t){c.counties=a.areaCache[e],c.county.id=c.counties[0][0],c.county.name=c.counties[0][1],t&&t()}function o(e){var t;e.text?(c.county.id=e.value,c.county.name=e.text):(t=e.options[e.selectedIndex],c.county.id=t.value,c.county.name=t.text)}var c={provice:{id:a.submitObj.proviceId||a.provinces[0][0],name:a.showObj.proviceName||a.provinces[0][1]},city:{id:a.submitObj.cityId,name:a.showObj.cityName},county:{id:a.submitObj.countyId,name:a.showObj.countyName},cities:a.cities,counties:a.counties},l=!0;a.submitObj.proviceId?(a.submitObj.proviceId!=a.provinces[0][0]&&(l=!1),t()):n(a.provinces[0][0],function(){i(c.cities[0][0],function(){t()})})}),$("#sumbit").on("tap",function(){var e,t={};a.submitObj.level?""!=(e=$("#name").val())?Okay.util.isName(e=$("#name").val())?a.submitObj.relation?a.submitObj.proviceId?a.submitObj.education?a.submitObj.work?(t.parentname=e,t.studentSex=$('input[name="student"]:checked').val(),t.parentSex=$('input[name="parent"]:checked').val(),t.city=a.submitObj.proviceId+","+a.submitObj.cityId+","+a.submitObj.countyId,t.related=a.submitObj.relation,t.grade=a.submitObj.grade,t.education=a.submitObj.education,t.work=a.submitObj.work,t.mall_token=a.token,Okay.Ajax("post","/index.php?m=OkayMall&c=mobileMember&a=setLabel",t).done(function(e){var t;Okay.popUp("提交成功，恭喜您成为OKAY会员"),setTimeout(function(){t=Okay.util.searchUrl(n).returnURL?Okay.util.searchUrl(n).returnURL+Okay.util.splitUrl(n):"index.html",window.location.href=t},200)})):Okay.popUp("请选择职业"):Okay.popUp("请选择文化程度"):Okay.popUp("请选择区域"):Okay.popUp("请选择与学生关系"):Okay.popUp("家长姓名请输入1-10个汉字"):Okay.popUp("请输入家长姓名"):Okay.popUp("请选择年级")})}};