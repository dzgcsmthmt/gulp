var address={submitObj:{},showObj:{},areaCache:{},timer:null,provinces:[["110000","北京市"],["500000","重庆市"],["310000","上海市"],["120000","天津市"],["340000","安徽省"],["350000","福建省"],["820332","广东省"],["450000","广西壮族自治区"],["520000","贵州省"],["620000","甘肃省"],["130000","河北省"],["410000","河南省"],["420000","湖北省"],["430000","湖南省"],["460000","海南省"],["230000","黑龙江省"],["320000","江苏省"],["360000","江西省"],["220000","吉林省"],["210000","辽宁省"],["150000","内蒙古自治区"],["640000","宁夏回族自治区"],["630000","青海省"],["370000","山东省"],["140000","山西省"],["510000","四川省"],["610000","陕西省"],["540000","西藏自治区"],["650000","新疆维吾尔自治区"],["530000","云南省"],["330000","浙江省"]],init:function(){this.initData(),this.initEvent()},initData:function(){var e,t,i=this;i.search=location.search,i.token=Okay.util.getCookie("mall_token"),i.token?(e=Okay.util.searchUrl(location.search).addressId)?($(".h1").html("修改收货人信息").removeClass("dn"),Okay.Ajax("post","/index.php?c=MobileAddress&a=getAddress",{addressId:e,mall_token:i.token}).done(function(e){t=e.data[0],i.addressId=t.addressId,$("#area").html(t.areaName1+" "+t.areaName2+" "+t.areaName3).parent().addClass("selected"),$("#street").val(t.address),$("#name").val(t.userName),$("#phone").val(t.userPhone),t.email&&$("#mail").val(t.email),1==t.isDefault&&$('input[type="checkbox"]').prop("checked",!0),i.submitObj.proviceId=t.areaId1,i.showObj.proviceName=t.areaName1,i.submitObj.cityId=t.areaId2,i.showObj.cityName=t.areaName2,i.submitObj.countyId=t.areaId3,i.showObj.countyName=t.areaName3,Okay.Ajax("post","/index.php?m=OkayMall&c=mobileAreas&a=getAllAreas",{parentId:i.submitObj.proviceId,mall_token:i.token}).done(function(e){i.cities=e.data.cities,i.areaCache[i.submitObj.proviceId]=e.data.cities,Okay.util.extendDefaults(i.areaCache,e.data.counties),i.counties=e.data.counties[i.submitObj.cityId]})})):$(".h1").removeClass("dn"):window.location.href="login.html"},initEvent:function(){function e(e,t,i){for(var a="",n=0,c=e.length;n<c;n++)a+="<option value="+e[n][0]+">"+e[n][1]+"</option>";$("#drum_"+t).remove(),$("#"+t).removeData().html(a).drum({onChange:function(e){var t=e.options[e.selectedIndex];i({text:t.text,value:t.value})}})}var t,i=this;$(".back").on("tap",function(){window.history.back()}),$("#save").on("tap",function(){var e={email:"",address:"",areaId1:"",areaId2:"",areaId3:"",userName:"",userPhone:"",isDefault:0},a="";i.submitObj.proviceId?""!=(e.address=$("#street").val().trim())?""!=(e.userName=$("#name").val())?Okay.util.isName(e.userName=$("#name").val())?Okay.util.isPhone(e.userPhone=$("#phone").val())&&Okay.util.isPhone(e.userPhone=$("#phone").val())?(e.email=t=$("#mail").val().trim(),!t||Okay.util.isEmail(t)?($('input[type="checkbox"]:checked').length&&(e.isDefault=1),e.areaId1=i.submitObj.proviceId,e.areaId2=i.submitObj.cityId,e.areaId3=i.submitObj.countyId,e.mall_token=i.token,i.addressId?(e.id=i.addressId,a="/index.php?m=OkayMall&c=MobileAddress&a=edit"):a="/index.php?m=OkayMall&c=MobileAddress&a=add",Okay.Ajax("post",a,e).done(function(e){1==e.addressNum?window.location.href="order-info.html":window.location.href="address-list.html"})):Okay.popUp("请填写正确的邮箱格式")):Okay.popUp("请填写正确的手机号"):Okay.popUp("收货人姓名请输入1-10个汉字"):Okay.popUp("请输入收货人姓名"):Okay.popUp("请填写详细地址"):Okay.popUp("请选择区域")}),$(".area").on("tap",function(){function t(){new Okay.Select({title:"区域",content:[{id:"provice-select",select:i.provinces,onChange:function(t){var d=t.options[t.selectedIndex];o.provice.id=d.value,o.provice.name=d.text,s?(clearTimeout(i.timer),i.timer=setTimeout(function(){a(d.value,function(){e(o.cities,"city-select",function(t){o.city.id=t.value,o.city.name=t.text,n(t.value,function(t){e(o.counties,"county-select",function(e){c(e)})})}),n(o.cities[0][0],function(t){e(o.counties,"county-select",function(e){c(e)})})})},150)):s=!0},selectIndex:Okay.util.findWhere(i.provinces,{0:o.provice.id})},{id:"city-select",select:o.cities,onChange:function(t){var i=t.options[t.selectedIndex];o.city.id=i.value,o.city.name=i.text,n(i.value,function(t){e(o.counties,"county-select",function(e){c(e)})})},selectIndex:Okay.util.findWhere(o.cities,{0:o.city.id})},{id:"county-select",select:o.counties,onChange:function(e){c(e)},selectIndex:Okay.util.findWhere(o.counties,{0:o.county.id})}],onaccept:function(){i.submitObj.proviceId=o.provice.id,i.showObj.proviceName=o.provice.name,i.submitObj.cityId=o.city.id,i.showObj.cityName=o.city.name,i.submitObj.countyId=o.county.id,i.showObj.countyName=o.county.name,i.cities=o.cities,i.counties=o.counties,$(".area").addClass("selected").find("span").html(o.provice.name+" "+o.city.name+" "+o.county.name)}})}function a(e,t){i.areaCache[e]?(o.cities=i.areaCache[e],o.city.id=o.cities[0][0],o.city.name=o.cities[0][1],t&&t()):Okay.Ajax("post","/index.php?m=OkayMall&c=mobileAreas&a=getAllAreas",{parentId:e}).done(function(a){o.cities=a.data.cities,i.areaCache[e]=a.data.cities,Okay.util.extendDefaults(i.areaCache,a.data.counties),o.city.id=o.cities[0][0],o.city.name=o.cities[0][1],t&&t()})}function n(e,t){o.counties=i.areaCache[e],o.county.id=o.counties[0][0],o.county.name=o.counties[0][1],t&&t()}function c(e){var t;e.text?(o.county.id=e.value,o.county.name=e.text):(t=e.options[e.selectedIndex],o.county.id=t.value,o.county.name=t.text)}var o={provice:{id:i.submitObj.proviceId||i.provinces[0][0],name:i.showObj.proviceName||i.provinces[0][1]},city:{id:i.submitObj.cityId,name:i.showObj.cityName},county:{id:i.submitObj.countyId,name:i.showObj.countyName},cities:i.cities,counties:i.counties},s=!0;i.submitObj.proviceId?(i.submitObj.proviceId!=i.provinces[0][0]&&(s=!1),t()):a(i.provinces[0][0],function(){n(o.cities[0][0],function(){t()})})})}};