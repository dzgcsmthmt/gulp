var order={init:function(){this.initData(),this.initEvent()},initData:function(){function e(e){var s="";return e?(a.addressId=e.addressId,s+="<div><em>"+e.userName+'</em><em class="phone">'+e.userPhone+"</em>"+(1==e.isDefault?'<span class="btn btn-sm">默认地址</span>':"")+"</div>",s+='<div class="group clearfix"><div class="fl address">',s+="<div>"+e.areaName1+" "+e.areaName2+" "+e.areaName3+'</div><div class="text-ellipsis">'+e.address+"</div>",s+='</div><div class="fr forward"><a href="address-list.html?addressId='+a.addressId+'"><i class="icon icon-forward"></i></a></div></div>',e.email&&(s+='<div class="mail">'+e.email+"</div>")):(s+="添加收货人信息",$("#address").addClass("empty")),s}function s(e){for(var s="",i=0,d=e.length;i<d;i++){var r=e[i];s+='<li><div class="order-product clearfix">',s+='<div class="img fl"><img src="'+r.goodsThums+'" /></div>',s+='<div class="desc fl">'+r.goodsName+"</div>",s+='<div class="price fl"><div class="em">￥'+(a.isMember?r.memberPrice:r.shopPrice)+"</div>",s+='<div class="quantity"><span class="small">X</span><span>'+r.goodsNum+"</span></div>",s+="</div></div></li>"}return s}var a=this;if(a.token=Okay.util.getCookie("mall_token"),a.token){var i,d=Okay.util.searchUrl(location.search).addressId;i=d?{mall_token:a.token,addressId:d}:{mall_token:a.token},Okay.Ajax("post","/index.php?m=OkayMall&c=mobileCart&a=orderPrepare",i,!0,!0).done(function(i){a.isMember=1==i.isMember,a.isMember||$("#member").removeClass("dn"),i.goodsList||(window.location.href="index.html"),$("#address").html(e(i.address)),$(".order-list").html(s(i.goodsList)),$(".tool-bar").html('<span class="deliver-fee">'+(0==i.shippingFee?"包邮":"邮费：￥"+i.shippingFee)+'</span><span id="total-price">合计：￥'+i.goodsAmount+"</span>"),i.shippingFee>0&&$("#deliver-tip").addClass("tool-tip").html("30元以下商品运费￥"+i.rate+"，两件包邮")}).fail(function(e){-1==e.status&&(window.location.href="index.html")})}else window.location.href="login.html"},initEvent:function(){var e=this,s=location.search;$(".back").on("tap",function(){window.history.back()}),$("#member").on("tap",function(){window.location.href=s?"member.html?returnURL=order-info.html&"+s.substring(1):"member.html?returnURL=order-info.html"}),$("#address").on("tap",function(){e.addressId?window.location.href="address-list.html?addressId="+e.addressId:window.location.href="address.html"}),$("#submit").on("tap",function(){var s;e.addressId?(s={remarks:$("#invoice-title").val().trim(),addressId:e.addressId,mall_token:e.token},Okay.Ajax("post","/index.php?m=OkayMall&c=mobileOrders&a=orderSubmit",s).done(function(e){window.location.href="pay.html?orderId="+e.orderIds})):Okay.popUp("请添加收货人信息")})}};