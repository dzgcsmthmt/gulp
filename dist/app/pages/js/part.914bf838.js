var part={upperLimit:100,scrollElem:$("#to-top"),init:function(){this.checkLogin(),this.initEvent()},checkLogin:function(){var e,o=this;Okay.util.isInApp()?(Okay.util.isIOS()?(this.user=window.resultIos,sessionStorage.setItem("isInIOSApp",!0),sessionStorage.setItem("IOSToken",this.user.token),sessionStorage.setItem("IOSUid",this.user.uid)):(e=okay.getJsonData(),this.user=JSON.parse(e)),$.ajax({type:"post",url:Okay.util.URL+"/index.php?c=MobileUsers&a=login",data:{token:this.user.token,systemId:this.user.uid}}).done(function(e){/200$/.test(e.status)?(localStorage.setItem("phone",e.phone),o.isLogin=!0,o.token=e.mall_token,Okay.util.setCookie("mall_token",e.mall_token,24)):Okay.popUp(e.msg),o.loadData()}).fail(function(e,o){var t="parsererror"==o?"数据返回格式错误":"网络异常";Okay.popUp(t)})):($(".app-download").removeClass("dn"),this.token=Okay.util.getCookie("mall_token"),this.loadData())},loadData:function(){function e(e){for(var o="",t=0,n=(e=e.root).length;t<n;t++){var s=e[t];o+='<li><a href="product.html?goodsId='+s.goodsId+'">',o+='<div class="img"><img src="'+s.goodsThums+'" /></div>',o+='<div class="info"><div class="desc">'+s.goodsName+'</div><div class="price">￥'+s.shopPrice+"</div></div>"}return o+='</a></li><li class="vl"></li>'}$("#menu").append(Okay.util.createMenuList());var o=this;Okay.Ajax("post","/index.php?m=OkayMall&c=mobileGoods&a=getGoods",{mall_token:o.token}).done(function(t){$("footer").removeClass("fixed"),$(".part-list").html(e(t.data)),o.token&&(0==t.goodsSum?$(".num").hide().parent().show():$(".num").html(t.goodsSum>99?"99+":t.goodsSum).parent().show())})},initEvent:function(){var e=this,o=Okay.util.debounce(function(){$(document).scrollTop()>e.upperLimit?e.scrollElem.removeClass("dn"):e.scrollElem.addClass("dn")},150);$(window).on("scroll",o),this.scrollElem.on("tapend",function(o){o.preventDefault(),$("html,body").scrollTop(0),e.scrollElem.addClass("dn")}),$("#theme").on("tap",function(e){e.preventDefault(),$("#menu").show()}),$("#menu").on("tap","a",function(e){e.preventDefault(),$("#menu").hide(),window.location.href=$(this).data("href")}),$("#close").on("tap",function(e){e.preventDefault(),$("#menu").hide()}),$("#user").on("tap",function(){e.token?window.location.href="user.html?returnURL=index.html":window.location.href="login.html?returnURL=index.html"}),$("#share").on("tap",function(){e.isShareOpen?$(".share-box").show():(e.isShareOpen=!0,$("body").append($("#"+(Okay.util.isInApp()?"app":"web")+"-share").html()))}),$(document).on("tap",".close",function(){$(".share-box").hide()})}};