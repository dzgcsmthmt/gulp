var signup={timer:null,msg_disabled:!1,init:function(){this.initEvent()},redirect:function(e,o){var a,t=Okay.util.searchUrl(e);"cart.html"==t.returnURL&&t.num?Okay.Ajax("post","/index.php?m=OkayMall&c=mobileCart&a=add",{gcount:t.num,goodsId:t.goodsId,mall_token:o}).done(function(e){window.location.href="cart.html"}):(a=t.returnURL?Okay.util.searchUrl(e).returnURL+Okay.util.splitUrl(e):"index.html",window.location.href=a)},countDown:function(){var e=60,o=this;o.timer=setInterval(function(){$("#msg-code").html(--e+"S"),0==e&&(clearInterval(o.timer),$("#msg-code").html("获取验证码").removeClass("disabled"),o.msg_disabled=!1)},1e3)},initEvent:function(){var e=Okay.util,o=this,a=location.search;$("#submit").on("tap",function(){var t,n,i,l,s;e.isPhone(t=$("#phone").val())?e.isMsgCode(n=$("#code").val())?e.isPwd(i=$("#pwd").val())?e.isPwd(l=$("#re-pwd").val())&&i==l?(s={protocol:1,verifyTel:t,password:i,comfirmPassword:l,regcode:n,ring_mall_token:o.ring},Okay.Ajax("post","/index.php?c=MobileUsers&a=toOkayMallRegist",s).done(function(e){Okay.util.setCookie("mall_token",e.mall_token,24),o.redirect(a,e.mall_token)})):Okay.popUp("密码不一致"):Okay.popUp("请输入6-16位密码，只能为数字或者字母"):Okay.popUp("请输入正确的验证码"):Okay.popUp("请输入正确的手机号")}),$("#msg-code").on("tap",function(){var a=$("#phone").val();e.isPhone(a)?o.msg_disabled||(o.msg_disabled=!0,$(this).html("60S").addClass("disabled"),o.countDown(),$.ajax({type:"post",url:Okay.util.URL+"/index.php?c=MobileUsers&a=getPhoneVerifyCode",data:{userPhone:a}}).done(function(e){/200$/.test(e.status)?(o.ring=e.ring_mall_token,Okay.popUp("验证码已发送")):(Okay.popUp(e.msg),clearInterval(o.timer),$("#msg-code").html("获取验证码").removeClass("disabled"),o.msg_disabled=!1)}).fail(function(e,a){var t="parsererror"==a?"数据返回格式错误":"网络异常";Okay.popUp(t),clearInterval(o.timer),$("#msg-code").html("获取验证码").removeClass("disabled"),o.msg_disabled=!1})):Okay.popUp("请输入正确的手机号")}),$(".back").on("tap",function(){window.history.back()}),$("#login").on("tap",function(){window.location.href="login.html"+a})}};